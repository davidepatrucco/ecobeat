# üå± Ecobeat - Sustainable Lifestyle Tracking

**Ecobeat** √® un'applicazione mobile che gamifica le azioni sostenibili quotidiane, aiutando gli utenti a tracciare e ridurre la loro impronta di carbonio.

## üèóÔ∏è Architettura

### **Monorepo Structure**

```
ecobeat/
‚îú‚îÄ‚îÄ üì± apps/
‚îÇ   ‚îú‚îÄ‚îÄ mobile/          # React Native app (Expo)
‚îÇ   ‚îî‚îÄ‚îÄ api/             # Node.js API (Express + AWS Lambda)
‚îú‚îÄ‚îÄ üì¶ packages/
‚îÇ   ‚îú‚îÄ‚îÄ shared/          # Types, utilities, config condivisi
‚îÇ   ‚îî‚îÄ‚îÄ theme/           # Design tokens e colori
‚îú‚îÄ‚îÄ üèóÔ∏è infrastructure/   # AWS CDK (Lambda, API Gateway, KMS, SES)
‚îú‚îÄ‚îÄ üìã docs/             # Documentazione
‚îî‚îÄ‚îÄ ‚öôÔ∏è Root configs      # ESLint, Prettier, Husky hooks
```

### **Tech Stack**

- **Mobile**: React Native + Expo + TypeScript
- **Backend**: Node.js + Express + AWS Lambda
- **Database**: MongoDB Atlas
- **Infrastructure**: AWS CDK + CloudFormation
- **Authentication**: JWT + AWS KMS signing + Refresh Tokens
- **Email**: AWS SES con template HTML/text
- **Security**: Rate limiting + bcrypt + CORS
- **Monitoring**: CloudWatch + X-Ray

## üöÄ Quick Start

### **Prerequisites**

- Node.js 20+
- pnpm 8+
- Expo CLI
- AWS CLI (for deployment)

### **Installation**

```bash
# Clone repository
git clone https://github.com/davidepatrucco/ecobeat.git
cd ecobeat

# Install dependencies
pnpm install

# Start development
pnpm dev               # Both mobile + API
pnpm dev:mobile        # Solo mobile app
pnpm dev:api           # Solo API server
```

### **Development URLs**

- **Mobile App**: Expo QR Code ‚Üí scan with Expo Go
- **API Server**: http://localhost:3000
- **Health Check**: http://localhost:3000/health
- **JWKS Endpoint**: http://localhost:3000/.well-known/jwks.json

## üîê Authentication System

### **‚úÖ Implemented Features**

- **JWT Authentication** with AWS KMS signing
- **Refresh Token Rotation** with secure storage
- **Email Verification** with AWS SES integration
- **Password Reset** with secure token-based flow
- **Biometric Authentication** for mobile devices
- **Rate Limiting** to prevent abuse
- **JWKS Endpoint** for JWT public key distribution

### **Security Features**

- üîê **KMS Integration**: JWT signing with AWS KMS (RSA-2048)
- üîÑ **Token Rotation**: Automatic refresh token rotation
- üìß **Email Verification**: SES with HTML/text templates
- üõ°Ô∏è **Rate Limiting**: Multiple levels of protection
- üì± **Biometric Support**: Touch ID / Face ID integration
- üîí **Secure Storage**: Encrypted credential management
- ‚è∞ **TTL Management**: Automatic cleanup of expired tokens

## üå≥ Git Workflow

| Branch    | Environment | Auto-Deploy | URL                     |
| --------- | ----------- | ----------- | ----------------------- |
| `develop` | Development | ‚ùå          | localhost               |
| `staging` | Staging     | ‚úÖ          | api-staging.ecobeat.app |
| `main`    | Production  | ‚ùå Manual   | api.ecobeat.app         |

üìñ **[Detailed Branching Strategy](docs/BRANCHING.md)**

## üõ†Ô∏è Development Commands

### **App Development**

```bash
pnpm dev:mobile        # Start Expo mobile app
pnpm dev:api           # Start API server locally
pnpm build             # Build all apps
pnpm test              # Run all tests
pnpm lint              # Lint all code
```

## üîë **Authentication & Security Features**

### **JWT & JWKS Implementation**

- ‚úÖ **JWT Signing**: AWS KMS RSA-2048 keys with rotation support
- ‚úÖ **JWKS Endpoint**: Standard `/.well-known/jwks.json` for distributed validation
- ‚úÖ **JWT Validator**: Server-side validation with signature verification
- ‚úÖ **Key Management**: Automatic key extraction from KMS (n, e values)
- ‚úÖ **Caching**: 15-minute JWKS cache for optimal performance

### **Biometric Authentication**

- ‚úÖ **Device Registration**: Secure biometric credential storage
- ‚úÖ **Challenge/Response**: Cryptographic challenge generation
- ‚úÖ **Multi-Device Support**: Multiple biometric credentials per user
- ‚úÖ **Credential Management**: Registration, verification, and revocation APIs

### **Email Security**

- ‚úÖ **AWS SES Integration**: Production-ready email service
- ‚úÖ **Template System**: Professional HTML + text email templates
- ‚úÖ **Parameter Store**: Environment-specific configuration loading
- ‚úÖ **Rate Limiting**: Multi-level spam protection system

### **API Testing**

```bash
# Test authentication endpoints
curl -X POST http://localhost:3000/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"TestPassword123!","firstName":"Test","lastName":"User"}'

curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"TestPassword123!"}'

# Test JWKS and JWT validation
curl http://localhost:3000/.well-known/jwks.json
curl http://localhost:3000/test/jwks  # Development test endpoint

# Test biometric authentication
curl -X POST http://localhost:3000/biometric/register \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{"deviceInfo":{"name":"iPhone 15","biometricType":"faceID"}}'
```

### **Infrastructure**

```bash
pnpm infra:build       # Build CDK
pnpm infra:synth       # Generate CloudFormation
pnpm infra:deploy:staging  # Deploy to staging
pnpm infra:deploy:prod     # Deploy to production
```

## üìä **API Endpoints Documentation**

### **Authentication Endpoints**

| Method | Endpoint                | Description                               | Auth Required |
| ------ | ----------------------- | ----------------------------------------- | ------------- |
| POST   | `/auth/register`        | User registration with email verification | No            |
| GET    | `/auth/verify-email`    | Email verification via token              | No            |
| POST   | `/auth/login`           | Email/password login                      | No            |
| POST   | `/auth/refresh`         | Refresh JWT tokens                        | No            |
| POST   | `/auth/logout`          | Logout (invalidate refresh token)         | Yes           |
| POST   | `/auth/logout-all`      | Logout from all devices                   | Yes           |
| POST   | `/auth/forgot-password` | Request password reset email              | No            |
| POST   | `/auth/reset-password`  | Reset password with token                 | No            |

### **Biometric Authentication**

| Method | Endpoint                          | Description                       | Auth Required |
| ------ | --------------------------------- | --------------------------------- | ------------- |
| POST   | `/biometric/register`             | Register biometric credentials    | Yes           |
| POST   | `/biometric/challenge`            | Create authentication challenge   | Yes           |
| POST   | `/biometric/verify`               | Verify biometric authentication   | Yes           |
| GET    | `/biometric/credentials`          | List user's biometric credentials | Yes           |
| DELETE | `/biometric/revoke/:credentialId` | Revoke biometric credential       | Yes           |

### **Email Services**

| Method | Endpoint                     | Description               | Auth Required |
| ------ | ---------------------------- | ------------------------- | ------------- |
| POST   | `/email/send-verification`   | Send email verification   | No            |
| POST   | `/email/send-password-reset` | Send password reset email | No            |

### **Security & Utilities**

| Method | Endpoint                 | Description                         | Auth Required |
| ------ | ------------------------ | ----------------------------------- | ------------- |
| GET    | `/.well-known/jwks.json` | JSON Web Key Set for JWT validation | No            |
| GET    | `/health`                | Basic health check                  | No            |
| GET    | `/health/detailed`       | Detailed system health              | No            |
| GET    | `/test/jwks`             | JWKS test endpoint (dev only)       | No            |
| POST   | `/test/validate-jwt`     | JWT validation test (dev only)      | No            |

## üìä Rate Limiting Configuration

| Endpoint              | Window   | Max Requests | Purpose                   |
| --------------------- | -------- | ------------ | ------------------------- |
| Email Verification    | 15 min   | 3 requests   | Prevent email spam        |
| Password Reset        | 1 hour   | 5 requests   | Security protection       |
| Login Attempts        | 15 min   | 10 requests  | Brute force prevention    |
| Registration          | 1 hour   | 3 requests   | Account creation limits   |
| Email Verification DB | 24 hours | 5 emails     | Database-level protection |

## üöÄ Production Configuration

### **AWS Services Used**

- **Lambda**: Serverless API hosting
- **API Gateway**: HTTP endpoints and CORS
- **KMS**: JWT signing with RSA-2048 keys
- **SES**: Transactional email sending
- **Parameter Store**: Environment configuration
- **CloudWatch**: Logging and monitoring

### **Environment Variables**

```bash
# Required for production
NODE_ENV=production
AWS_REGION=us-east-1
KMS_KEY_ID=alias/ecobeat-jwt-signing-production

# Parameter Store paths (auto-loaded)
MONGODB_URI_PARAM=/ecobeat/production/mongodb/uri
FROM_EMAIL_PARAM=/ecobeat/production/ses/from-email
BASE_URL_PARAM=/ecobeat/production/app/base-url
```

### **SES Email Templates**

- **Email Verification**: Professional HTML + text templates
- **Password Reset**: Security-focused design with warnings
- **Template Features**: Responsive design, brand colors, clear CTAs

### **Security Best Practices**

- ‚úÖ bcrypt password hashing (salt rounds: 12)
- ‚úÖ JWT signed with AWS KMS (RSA-2048)
- ‚úÖ Refresh token rotation on every use
- ‚úÖ Rate limiting with in-memory + database checks
- ‚úÖ CORS configuration for specific origins
- ‚úÖ Helmet.js security headers
- ‚úÖ Input validation with Zod schemas
- ‚úÖ TTL cleanup for expired tokens

## ü§ù Contributing

## üì± Mobile App Features

### **Current (Phase 0)**

- ‚úÖ 5-tab navigation (Home, Activities, Challenges, Rewards, Profile)
- ‚úÖ CO‚ÇÇ impact tracking dashboard
- ‚úÖ Custom Ecobeat logo integration
- ‚úÖ TypeScript + ESLint + Prettier

### **Planned (Phase 1-3)**

- üîÑ User authentication (JWT)
- üîÑ Activity logging and CO‚ÇÇ calculation
- üîÑ Gamification system (challenges, rewards)
- üîÑ Social features and leaderboards

## üîß API Endpoints

### **‚úÖ Authentication**

- `POST /auth/register` - User registration with validation
- `POST /auth/login` - User login with rate limiting
- `POST /auth/refresh` - Refresh access token
- `POST /auth/logout` - Logout with token revocation
- `POST /auth/revoke-all` - Revoke all user tokens
- `GET /auth/me` - Get current user info

### **‚úÖ Email Services**

- `POST /email/send-verification` - Send email verification
- `POST /email/verify` - Verify email token
- `POST /email/send-password-reset` - Request password reset
- `POST /email/verify-reset-token` - Verify reset token
- `POST /email/reset-password` - Complete password reset

### **‚úÖ Biometric Authentication**

- `POST /biometric/register` - Register biometric credential
- `POST /biometric/challenge` - Create authentication challenge
- `POST /biometric/verify` - Verify biometric authentication
- `GET /biometric/credentials` - List user's credentials
- `DELETE /biometric/revoke` - Revoke biometric credential
- `GET /biometric/status/:deviceId` - Check biometric status

### **‚úÖ Security & Infrastructure**

- `GET /health` - Health check with detailed info
- `GET /.well-known/jwks.json` - JWT public keys

### **üîÑ Planned Features**

- `GET /activities` - List user activities
- `POST /activities` - Log new activity
- `GET /challenges` - Available challenges
- `GET /leaderboard` - User rankings

## üéØ Roadmap

### **‚úÖ Phase 0 - Setup (COMPLETED)**

- [x] Monorepo with pnpm workspaces
- [x] Mobile app with Expo + React Native
- [x] API server with Express + Lambda support
- [x] AWS CDK infrastructure setup
- [x] Git workflow + CI/CD preparation

### **‚úÖ Phase 1 - Infrastructure (COMPLETED)**

- [x] AWS CDK with KMS, SES, Parameter Store
- [x] MongoDB Atlas integration
- [x] Environment configuration (staging/production)
- [x] Security headers and CORS
- [x] Error handling and logging

### **‚úÖ Phase 2 - Authentication (COMPLETED)**

- [x] JWT authentication with KMS signing
- [x] User registration/login with validation
- [x] Password reset + email verification (SES)
- [x] Refresh token rotation system
- [x] Rate limiting + security middleware
- [x] Biometric authentication for mobile
- [x] JWKS endpoint for public key distribution

### **üîÑ Phase 3 - Core Features (NEXT)**

- [ ] Activity tracking and categorization
- [ ] CO‚ÇÇ calculation engine with real factors
- [ ] Challenges system with gamification
- [ ] Rewards and achievement system
- [ ] User profile and preferences
- [ ] Social features and leaderboards

### **üîÑ Phase 4 - Advanced Features**

- [ ] AI-powered personalized suggestions
- [ ] Push notifications with Expo
- [ ] Offline sync capabilities
- [ ] Advanced analytics dashboard
- [ ] B2B features for companies
- [ ] Third-party integrations (fitness apps, smart home)

## ü§ù Contributing

1. **Create feature branch** from `develop`
2. **Make changes** with tests
3. **Submit PR** to `develop`
4. **Deploy to staging** for testing
5. **Merge to main** for production

## üìÑ License

MIT License - see LICENSE file for details

---

**Made with üå± for a sustainable future**

## üèóÔ∏è Architettura

Il progetto √® strutturato come un **monorepo** con pnpm workspaces:

```
ecobeat/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îî‚îÄ‚îÄ mobile/           # App Expo React Native
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ shared/           # Tipi, utilities, schemas condivisi
‚îÇ   ‚îî‚îÄ‚îÄ theme/            # Design tokens (colori, tipografia, spacing)
‚îú‚îÄ‚îÄ infrastructure/       # CDK per AWS (da implementare)
‚îî‚îÄ‚îÄ docs/                 # Documentazione (da implementare)
```

## üöÄ Quick Start

### Prerequisiti

- **Node.js** ‚â• 18.0.0
- **pnpm** ‚â• 8.0.0
- **Expo CLI** (globale): `npm install -g @expo/cli`

### Setup

```bash
# Clone del repository
git clone https://github.com/davidepatrucco/ecobeat.git
cd ecobeat

# Installa le dipendenze
pnpm install

# Avvia l'app mobile in modalit√† sviluppo
cd apps/mobile
pnpm dev
```

### Sviluppo Mobile

```bash
# Avvia su iOS Simulator
pnpm ios

# Avvia su Android Emulator
pnpm android

# Avvia sul web
pnpm web

# Build per produzione
pnpm build
```

## üì± Tech Stack

### Frontend (Mobile)

- **Expo** (~53.0) con React Native 0.79
- **Expo Router** per la navigazione
- **NativeWind** (Tailwind CSS per React Native)
- **React Query** per state management remoto
- **Zustand** per state management locale
- **React Hook Form + Zod** per form validation
- **Expo Notifications** per push notifications
- **Expo Secure Store** per secure storage

### Backend (Pianificato)

- **AWS Lambda** + **API Gateway** (serverless)
- **MongoDB Atlas** (serverless)
- **AWS CDK** per Infrastructure as Code
- **Node.js + TypeScript**

### Packages Condivisi

- **@ecobeat/shared**: Tipi, utilities, validazione (Zod schemas)
- **@ecobeat/theme**: Design tokens, palette colori, tipografia

## üé® Design System

### Palette Colori

- **Primary** (Verde natura): `#22c55e` - Azioni positive, brand
- **Secondary** (Blu acqua): `#0ea5e9` - Dati, informazioni
- **Accent** (Giallo sole): `#eab308` - Gamification, reward
- **Neutral**: Scala di grigi per testi e sfondi

### Principi UX

- **Mobile-first**: Design ottimizzato per smartphone
- **Semplicit√†**: Max 2 tap per ogni azione principale
- **Feedback positivo**: Microinterazioni che celebrano i comportamenti sostenibili
- **Accessibilit√†**: Contrasti forti, testi leggibili, navigazione intuitiva

## üìä Funzionalit√† Principali

### MVP (Fase 1)

- ‚úÖ **Onboarding** con quiz personalizzazione
- ‚úÖ **Dashboard** con impatto settimanale CO‚ÇÇ
- ‚úÖ **Tracking attivit√†** sostenibili (trasporti, alimentazione, riciclo)
- ‚úÖ **Suggerimenti AI** base (rule-based)
- ‚úÖ **Gamification** semplice (punti, livelli, badge)

## üóìÔ∏è **Development Roadmap**

### **‚úÖ Phase 1 - Infrastructure & Authentication (COMPLETED)**

- ‚úÖ **Monorepo Setup**: PNPM workspaces with apps/mobile, apps/api, packages/shared
- ‚úÖ **AWS Infrastructure**: CDK stack with Lambda, API Gateway, KMS, SES
- ‚úÖ **Authentication System**: Complete JWT auth with refresh tokens
- ‚úÖ **Email Service**: AWS SES with production templates
- ‚úÖ **Rate Limiting**: Multi-level spam protection
- ‚úÖ **Biometric Auth**: Device-based authentication for mobile
- ‚úÖ **JWKS Endpoint**: Standard JWT validation for distributed systems
- ‚úÖ **Security Features**: bcrypt hashing, KMS signing, CORS, Helmet.js

### **üîÑ Phase 2 - Mobile Application (IN PROGRESS)**

- üîÑ **Expo Setup**: NativeWind, React Query, Zustand, i18n
- üîÑ **Auth Screens**: Login, Register, Biometric, Email verification
- üîÑ **Session Management**: Auto-refresh, secure storage
- üìã **Onboarding**: User profile setup and preferences
- üìã **Dashboard**: Impact tracking and quick actions

### **üìã Phase 3 - Core Features (PLANNED)**

- üìã **Activity Tracking**: Carbon footprint calculation engine
- üìã **Impact Analytics**: Weekly/monthly reporting with charts
- üìã **Gamification**: Points, badges, challenges system
- üìã **AI Suggestions**: Personalized eco-friendly recommendations

### **üìã Phase 4 - Rewards & Partnerships (PLANNED)**

- üìã **Reward System**: Points redemption and coupon engine
- üìã **Partner Integration**: Local business partnerships
- üìã **Marketplace**: Eco-friendly products and services

### **üìã Phase 5 - Advanced Features (FUTURE)**

- üìã **B2B Dashboard**: Corporate sustainability tracking
- üìã **IoT Integration**: Smart home and wearable devices
- üìã **Advanced AI**: Machine learning recommendations
- üìã **Community Features**: Social challenges and competitions

### Roadmap Future

- **Sfide** collaborative e personali
- **Marketplace reward** con partner locali
- **Funzionalit√† B2B** per aziende
- **AI avanzata** per suggerimenti personalizzati
- **Integrazione IoT** (smart home, wearables)

## üîß Scripts Disponibili

### Root Level

```bash
pnpm dev           # Avvia tutti i progetti in dev mode
pnpm build         # Build di tutti i progetti
pnpm test          # Test di tutti i progetti
pnpm lint          # Lint di tutti i progetti
pnpm lint:fix      # Fix automatico linting
pnpm format        # Format con Prettier
pnpm clean         # Pulizia di tutti i node_modules e build
```

### App Mobile

```bash
pnpm start         # Avvia Expo dev server
pnpm ios           # Avvia su iOS
pnpm android       # Avvia su Android
pnpm web           # Avvia su web
pnpm build         # Export per produzione
pnpm test          # Test con Jest
pnpm type-check    # TypeScript check
```

## üß™ Testing

```bash
# Test di tutto il monorepo
pnpm test

# Test solo app mobile
cd apps/mobile && pnpm test

# Test in watch mode
cd apps/mobile && pnpm test:watch
```

## üìö Struttura Progetto

### App Mobile (`apps/mobile/`)

```
app/
‚îú‚îÄ‚îÄ (tabs)/              # Tab navigation principale
‚îÇ   ‚îú‚îÄ‚îÄ index.tsx        # Home/Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ activities.tsx   # Tracking attivit√†
‚îÇ   ‚îú‚îÄ‚îÄ challenges.tsx   # Sfide e gamification
‚îÇ   ‚îú‚îÄ‚îÄ rewards.tsx      # Marketplace premi
‚îÇ   ‚îî‚îÄ‚îÄ profile.tsx      # Profilo utente
‚îú‚îÄ‚îÄ auth/                # Schermate autenticazione (da implementare)
‚îú‚îÄ‚îÄ onboarding/          # Flusso onboarding (da implementare)
‚îî‚îÄ‚îÄ _layout.tsx          # Root layout con providers
```

### Packages Condivisi

```
packages/
‚îú‚îÄ‚îÄ shared/src/
‚îÇ   ‚îú‚îÄ‚îÄ schemas.ts       # Zod schemas per validazione
‚îÇ   ‚îú‚îÄ‚îÄ constants.ts     # Costanti app (fattori CO‚ÇÇ, punti)
‚îÇ   ‚îú‚îÄ‚îÄ utils.ts         # Utilities (date, calcoli, formatters)
‚îÇ   ‚îî‚îÄ‚îÄ index.ts         # Export principale
‚îî‚îÄ‚îÄ theme/src/
    ‚îú‚îÄ‚îÄ colors.ts        # Palette colori
    ‚îú‚îÄ‚îÄ typography.ts    # Font, dimensioni, line-height
    ‚îú‚îÄ‚îÄ spacing.ts       # Spacing, border-radius, shadows
    ‚îî‚îÄ‚îÄ index.ts         # Theme object completo
```

## üöÄ Deployment

### Mobile (Expo)

```bash
# Build per store (future)
expo build:ios
expo build:android

# Over-the-Air Updates
expo publish
```

### Backend (Future)

```bash
# Deploy infrastruttura AWS
cd infrastructure
cdk deploy
```

## ü§ù Contributing

1. Fork del repository
2. Crea un branch feature: `git checkout -b feature/nome-feature`
3. Commit delle modifiche: `git commit -m 'Add: nuova feature'`
4. Push al branch: `git push origin feature/nome-feature`
5. Apri una Pull Request

### Commit Convention

- `feat:` Nuova funzionalit√†
- `fix:` Bug fix
- `docs:` Documentazione
- `style:` Formattazione, lint
- `refactor:` Refactoring codice
- `test:` Test
- `chore:` Maintenance

## üìÑ License

MIT License - vedi file [LICENSE](LICENSE) per dettagli.

## üë• Team

- **Davide Patrucco** - Project Lead & Full Stack Developer

---

üåç **Insieme per un futuro pi√π sostenibile!** üå±
